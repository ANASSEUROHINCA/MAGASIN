<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EUROHINCA | Gestion Stock</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2563eb; --bg: #f8fafc; --sidebar: #1e293b; --text: #334155;
            --white: #ffffff; --border: #e2e8f0; --success: #10b981; --danger: #ef4444;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* LOGIN */
        #login-screen { position: fixed; inset: 0; background: #0f172a; z-index: 1000; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .login-box { background: white; padding: 40px; border-radius: 16px; width: 320px; text-align: center; }
        .login-input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        
        /* LAYOUT */
        .sidebar { width: 260px; background: var(--sidebar); color: white; display: flex; flex-direction: column; }
        .logo { padding: 24px; font-size: 20px; font-weight: 700; border-bottom: 1px solid #334155; color: #60a5fa; }
        .menu { flex: 1; padding: 20px 10px; }
        .menu-item { padding: 12px 16px; margin-bottom: 4px; cursor: pointer; border-radius: 8px; color: #94a3b8; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: #334155; color: white; }
        
        .content { flex: 1; padding: 32px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
        .user-pill { background: white; padding: 8px 16px; border-radius: 50px; border: 1px solid var(--border); font-weight: 600; font-size: 14px; }
        
        /* COMPONENTS */
        .card { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card h3 { margin: 0 0 20px 0; font-size: 16px; color: #1e293b; display: flex; justify-content: space-between; align-items: center; }
        
        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px; }
        .field label { display: block; font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px; text-transform: uppercase; }
        .field input, .field select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; background: #f8fafc; box-sizing: border-box; }
        .field input:focus { border-color: var(--primary); outline: none; background: white; }
        
        .btn-row { display: flex; justify-content: flex-end; gap: 12px; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; color: white; font-size: 13px; }
        .btn-save { background: var(--success); }
        .btn-reset { background: #64748b; }
        .btn-plus { background: var(--primary); color: white; border: none; width: 38px; cursor: pointer; border-radius: 6px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; background: #f1f5f9; color: #475569; font-weight: 600; }
        td { padding: 12px; border-top: 1px solid var(--border); }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; }
        
        .hidden { display: none; }
        
        /* STATS */
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); text-align: center; }
        .stat-num { font-size: 24px; font-weight: 700; margin: 8px 0; }
    </style>
</head>
<body>

    <div id="login-screen">
        <form class="login-box" onsubmit="event.preventDefault();"> <i class="fas fa-layer-group" style="font-size: 40px; color: var(--primary); margin-bottom: 16px;"></i>
            <h2 style="margin: 0 0 20px 0;">EUROHINCA STOCK</h2>
            <select id="login-user" class="login-input">
                <option value="" disabled selected>Choisir Utilisateur</option>
                <option value="Issam Abahmane">Issam Abahmane</option>
                <option value="Mehdi Kridid">Mehdi Kridid</option>
                <option value="Yassine Faradi">Yassine Faradi</option>
                <option value="Zakaria Essabir">Zakaria Essabir</option>
                <option value="Admin">Admin</option>
            </select>
            <input type="password" id="login-pass" class="login-input" placeholder="Mot de passe (Optionnel)" autocomplete="current-password">
            <button class="btn-main" id="btn-login-submit">CONNEXION</button>
        </form>
    </div>

    <div class="sidebar">
        <div class="logo">EUROHINCA</div>
        <div class="menu">
            <div class="menu-item active" data-target="dashboard"><i class="fas fa-chart-pie"></i> Tableau de Bord</div>
            <div class="menu-item" data-target="huiles"><i class="fas fa-oil-can"></i> Huiles & Graisses</div>
            <div class="menu-item" data-target="bentonite"><i class="fas fa-flask"></i> Bentonite & Chimie</div>
            <div class="menu-item" data-target="stock"><i class="fas fa-cubes"></i> Stock Matériel</div>
            <div class="menu-item" data-target="sortie"><i class="fas fa-dolly-flatbed"></i> Sortie Matériel</div>
            <div class="menu-item" data-target="gasoil"><i class="fas fa-gas-pump"></i> Gestion Gasoil</div>
            <div class="menu-item" data-target="activity"><i class="fas fa-history"></i> Historique</div>
        </div>
    </div>

    <div class="content">
        <div class="header">
            <h1 id="page-title" style="margin:0; font-size: 24px;">Tableau de Bord</h1>
            <div class="user-pill"><i class="fas fa-user-circle"></i> <span id="current-user-display">Invité</span></div>
        </div>

        <div id="dashboard" class="section">
            <div class="stats">
                <div class="stat-box" style="border-top: 4px solid #2563eb;"><div class="stat-num" id="st-oil">0</div><div>Huiles</div></div>
                <div class="stat-box" style="border-top: 4px solid #eab308;"><div class="stat-num" id="st-ben">0</div><div>Chimie</div></div>
                <div class="stat-box" style="border-top: 4px solid #10b981;"><div class="stat-num" id="st-mat">0</div><div>Matériel</div></div>
                <div class="stat-box" style="border-top: 4px solid #ef4444;"><div class="stat-num" id="st-gas">0</div><div>Gasoil (L)</div></div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-database"></i> Initialisation (Si la base est vide)</h3>
                <p>Cliquez ici pour charger les listes (Soda Ash, Atlas Copco, etc.) dans Firebase.</p>
                <button class="btn btn-save" style="background:#8b5cf6;" id="btn-seed">Charger Listes</button>
            </div>
        </div>

        <div id="huiles" class="section hidden">
            <div class="card">
                <h3>Gestion Huiles</h3>
                <form id="form-oil">
                    <input type="hidden" id="oil_id">
                    <div class="grid-form">
                        <div class="field"><label>Produit</label><div style="display:flex; gap:5px;"><select id="oil_name"></select><button type="button" class="btn-plus" onclick="window.app.addDynamicItem('list_oils', 'oil_name')"><i class="fas fa-plus"></i></button></div></div>
                        <div class="field"><label>Quantité</label><input type="number" id="oil_qty"></div>
                        <div class="field"><label>Unité</label><input type="text" id="oil_unit"></div>
                        <div class="field"><label>Alerte</label><input type="number" id="oil_alert" value="2"></div>
                    </div>
                    <div class="btn-row"><button type="button" class="btn btn-reset" onclick="window.app.resetForm('form-oil')">Nouveau</button><button type="button" class="btn btn-save" onclick="window.app.saveOil()">Enregistrer</button></div>
                </form>
            </div>
            <div class="card">
                <h3>Inventaire <button class="btn" style="background:#217346; padding:4px 8px;" onclick="window.app.exportTable('table-oil','Huile')">Excel</button></h3>
                <div style="overflow-x:auto;"><table id="table-oil"><thead><tr><th>Nom</th><th>Qté</th><th>Unité</th><th>Seuil</th><th>Date</th><th>Action</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>

        <div id="bentonite" class="section hidden">
            <div class="card">
                <h3>Gestion Bentonite</h3>
                <form id="form-ben">
                    <input type="hidden" id="ben_id">
                    <div class="grid-form">
                        <div class="field"><label>Produit</label><div style="display:flex; gap:5px;"><select id="ben_name"></select><button type="button" class="btn-plus" onclick="window.app.addDynamicItem('list_chemicals', 'ben_name')"><i class="fas fa-plus"></i></button></div></div>
                        <div class="field"><label>Quantité</label><input type="number" id="ben_qty"></div>
                        <div class="field"><label>Unité</label><input type="text" id="ben_unit"></div>
                        <div class="field"><label>Alerte</label><input type="number" id="ben_alert" value="50"></div>
                    </div>
                    <div class="btn-row"><button type="button" class="btn btn-reset" onclick="window.app.resetForm('form-ben')">Nouveau</button><button type="button" class="btn btn-save" onclick="window.app.saveBen()">Enregistrer</button></div>
                </form>
            </div>
            <div class="card">
                <h3>Inventaire <button class="btn" style="background:#217346; padding:4px 8px;" onclick="window.app.exportTable('table-ben','Chimie')">Excel</button></h3>
                <div style="overflow-x:auto;"><table id="table-ben"><thead><tr><th>Nom</th><th>Qté</th><th>Unité</th><th>Seuil</th><th>Date</th><th>Action</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>

        <div id="gasoil" class="section hidden">
            <div class="card">
                <h3>Gestion Gasoil</h3>
                <div style="background:#eff6ff; padding:15px; margin-bottom:15px; border-radius:8px; color:#1e40af; font-weight:bold; display:flex; justify-content:space-between;">
                    <span>Stock: <span id="gas_val">...</span> Litres</span>
                    <button style="border:none; background:none; cursor:pointer; color:#2563eb;" onclick="window.app.editGasoilStock()"><i class="fas fa-pen"></i></button>
                </div>
                <form id="form-gasoil">
                    <div class="grid-form">
                        <div class="field"><label>Machine</label><div style="display:flex; gap:5px;"><select id="gas_machine"></select><button type="button" class="btn-plus" onclick="window.app.addDynamicItem('list_machines', 'gas_machine')"><i class="fas fa-plus"></i></button></div></div>
                        <div class="field"><label>Shift</label><select id="gas_shift"><option>Day</option><option>Night</option></select></div>
                        <div class="field"><label>Conso (L)</label><input type="number" id="gas_conso"></div>
                        <div class="field"><label>Date/Heure</label><div style="display:flex; gap:5px;"><input type="date" id="gas_date"><input type="time" id="gas_time"></div></div>
                    </div>
                    <div class="btn-row"><button type="button" class="btn btn-save" style="background:#ef4444;" onclick="window.app.saveGasoil()">Valider Conso</button></div>
                </form>
            </div>
            <div class="card">
                <h3>Historique <button class="btn" style="background:#217346; padding:4px 8px;" onclick="window.app.exportTable('table-gasoil','Gasoil')">Excel</button></h3>
                <div style="overflow-x:auto;"><table id="table-gasoil"><thead><tr><th>Date</th><th>Heure</th><th>Machine</th><th>Shift</th><th>Conso</th><th>User</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>

        <div id="stock" class="section hidden">
            <div class="card">
                <h3>Stock Matériel</h3>
                <form id="form-stock"><input type="hidden" id="stk_id">
                    <div class="grid-form">
                        <div class="field"><label>Désignation</label><input type="text" id="stk_des"></div>
                        <div class="field"><label>Catégorie</label><div style="display:flex; gap:5px;"><select id="stk_cat"></select><button type="button" class="btn-plus" onclick="window.app.addDynamicItem('list_cats', 'stk_cat')"><i class="fas fa-plus"></i></button></div></div>
                        <div class="field"><label>Qté</label><input type="number" id="stk_qty"></div>
                        <div class="field"><label>Emplacement</label><input type="text" id="stk_loc"></div>
                        <div class="field"><label>Seuil</label><input type="number" id="stk_alert" value="5"></div>
                    </div>
                    <div class="btn-row"><button type="button" class="btn btn-reset" onclick="window.app.resetForm('form-stock')">Reset</button><button type="button" class="btn btn-save" onclick="window.app.saveStock()">Enregistrer</button></div>
                </form>
            </div>
            <div class="card"><h3>Liste</h3><table id="table-stock"><thead><tr><th>Nom</th><th>Cat</th><th>Loc</th><th>Qté</th><th>Seuil</th><th>Action</th></tr></thead><tbody></tbody></table></div>
        </div>

        <div id="sortie" class="section hidden">
            <div class="card">
                <h3>Sortie Matériel</h3>
                <form id="form-sortie">
                    <div class="grid-form">
                        <div class="field"><label>Produit</label><input type="text" id="sort_nom"></div>
                        <div class="field"><label>Qté</label><input type="number" id="sort_qty"></div>
                        <div class="field"><label>Destination</label><select id="sort_dest"><option>Chantier</option><option>Atelier</option><option>Casablanca</option></select></div>
                        <div class="field"><label>Reçu par</label><input type="text" id="sort_rec"></div>
                    </div>
                    <div class="btn-row"><button type="button" class="btn btn-save" onclick="window.app.saveSortie()">Valider Sortie</button></div>
                </form>
            </div>
            <div class="card"><h3>Historique Sorties</h3><table id="table-sortie"><thead><tr><th>Produit</th><th>Qté</th><th>Dest</th><th>Reçu par</th><th>Date</th></tr></thead><tbody></tbody></table></div>
        </div>

        <div id="activity" class="section hidden">
            <div class="card"><h3>Historique Global</h3><table id="table-act"><thead><tr><th>Date</th><th>Heure</th><th>User</th><th>Action</th><th>Détails</th></tr></thead><tbody></tbody></table></div>
        </div>

    </div>

    <script type="module" src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
